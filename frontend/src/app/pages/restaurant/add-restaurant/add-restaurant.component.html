<div class="container py-4"> <div class="card shadow p-4"> <h2 class="text-center mb-4"> {{ isEditMode ? 'Editar Restaurante' : 'Agregar Nuevo Restaurante' }}
</h2>

<form [formGroup]="restaurantForm" (ngSubmit)="onSubmit()">
  <div class="mb-3">
    <label for="name" class="form-label">Nombre del Restaurante</label>
    <input
      id="name"
      type="text"
      formControlName="name"
      class="form-control"
      placeholder="Ej: La Esquina del Sabor"
    >
    <div *ngIf="restaurantForm.get('name')?.invalid && (restaurantForm.get('name')?.dirty || restaurantForm.get('name')?.touched)" class="text-danger mt-1">
      <div *ngIf="restaurantForm.get('name')?.errors?.['required']">El nombre es obligatorio.</div>
      <div *ngIf="restaurantForm.get('name')?.errors?.['maxlength']">El nombre no puede exceder 100 caracteres.</div>
    </div>
  </div>

  <div class="mb-3">
    <label for="imageUrl" class="form-label">URL de la Imagen</label>
    <input
      id="imageUrl"
      type="url"
      formControlName="imageUrl"
      class="form-control"
      placeholder="Ej: https://ejemplo.com/imagen.jpg"
    >
    <div *ngIf="restaurantForm.get('imageUrl')?.invalid && (restaurantForm.get('imageUrl')?.dirty || restaurantForm.get('imageUrl')?.touched)" class="text-danger mt-1">
      <div *ngIf="restaurantForm.get('imageUrl')?.errors?.['required']">La URL de la imagen es obligatoria.</div>
      <div *ngIf="restaurantForm.get('imageUrl')?.errors?.['pattern']">Por favor ingrese una URL válida (ej: https://...).</div>
    </div>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Descripción (Opcional)</label>
    <textarea
      id="description"
      formControlName="description"
      rows="3"
      class="form-control"
      placeholder="Ej: Un lugar acogedor con la mejor comida casera..."
    ></textarea>
    <div *ngIf="restaurantForm.get('description')?.errors?.['maxlength'] && (restaurantForm.get('description')?.dirty || restaurantForm.get('description')?.touched)" class="text-danger mt-1">
      La descripción no puede exceder 500 caracteres.
    </div>
  </div>

  <hr class="my-4"> <h3 class="mb-3">Ubicación</h3>

  <div class="row g-3"> <div class="col-md-6">
      <label for="province" class="form-label">Provincia</label>
      <select
        id="province"
        formControlName="address.province"
        class="form-select"
      >
        <option [ngValue]="null" disabled>Seleccione una provincia</option>
        <option *ngFor="let province of allProvinces" [ngValue]="province.id">{{ province.nombre }}</option>
      </select>
      <div *ngIf="restaurantForm.get('address.province')?.invalid && (restaurantForm.get('address.province')?.dirty || restaurantForm.get('address.province')?.touched)" class="text-danger mt-1">
        <div *ngIf="restaurantForm.get('address.province')?.errors?.['required']">La provincia es obligatoria.</div>
      </div>
    </div>

    <div class="col-md-6">
      <label for="city" class="form-label">Ciudad</label>
      <select
        id="city"
        formControlName="address.city"
        class="form-select"
        [disabled]="!restaurantForm.get('address.province')?.value || filteredMunicipalities.length === 0"
      >
        <option [ngValue]="null" disabled>Seleccione una ciudad</option>
        <option *ngFor="let municipality of filteredMunicipalities" [ngValue]="municipality.id">{{ municipality.nombre }}</option>
      </select>
      <div *ngIf="restaurantForm.get('address.city')?.invalid && (restaurantForm.get('address.city')?.dirty || restaurantForm.get('address.city')?.touched)" class="text-danger mt-1">
        <div *ngIf="restaurantForm.get('address.city')?.errors?.['required']">La ciudad es obligatoria.</div>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-3"> <div class="col-md-6">
      <label for="street" class="form-label">Calle</label>
      <input
        id="street"
        type="text"
        formControlName="address.street"
        class="form-control"
        placeholder="Ej: Av. Rivadavia"
      >
      <div *ngIf="restaurantForm.get('address.street')?.invalid && (restaurantForm.get('address.street')?.dirty || restaurantForm.get('address.street')?.touched)" class="text-danger mt-1">
        <div *ngIf="restaurantForm.get('address.street')?.errors?.['required']">La calle es obligatoria.</div>
        <div *ngIf="restaurantForm.get('address.street')?.errors?.['maxlength']">La calle no puede exceder 100 caracteres.</div>
      </div>
    </div>

    <div class="col-md-6">
      <label for="number" class="form-label">Número</label>
      <input
        id="number"
        type="text"
        formControlName="address.number"
        class="form-control"
        placeholder="Ej: 1234"
        pattern="[0-9]*"
      >
      <div *ngIf="restaurantForm.get('address.number')?.invalid && (restaurantForm.get('address.number')?.dirty || restaurantForm.get('address.number')?.touched)" class="text-danger mt-1">
        <div *ngIf="restaurantForm.get('address.number')?.errors?.['required']">El número es obligatorio.</div>
        <div *ngIf="restaurantForm.get('address.number')?.errors?.['pattern']">El número debe ser un valor numérico.</div>
        <div *ngIf="restaurantForm.get('address.number')?.errors?.['maxlength']">El número no puede exceder 20 caracteres.</div>
      </div>
    </div>
  </div>

  <input type="hidden" formControlName="address.latitude">
  <input type="hidden" formControlName="address.longitude">

  <div class="mb-3 mt-4"> <label class="form-label">Seleccione ubicación en el mapa</label>
    <div class="map-container border rounded overflow-hidden"> <app-location-picker
        (locationSelected)="onLocationSelected($event)"
      ></app-location-picker>
    </div>
    <div *ngIf="restaurantForm.get('address.latitude')?.invalid && (restaurantForm.get('address.latitude')?.dirty || restaurantForm.get('address.latitude')?.touched)" class="text-danger mt-1">
      <div *ngIf="restaurantForm.get('address.latitude')?.errors?.['required']">Debe seleccionar una ubicación en el mapa.</div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center my-3 alert alert-info" role="alert">
    Cargando...
  </div>

  <div *ngIf="successMessage" class="my-3 alert alert-success" role="alert">
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="my-3 alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <div class="d-flex justify-content-end mt-4"> <button
      type="button"
      (click)="onCancel()"
      class="btn btn-secondary me-2"
    >
      Cancelar
    </button>
    <button
      type="submit"
      class="btn btn-danger" [disabled]="restaurantForm.invalid || isLoading"
    >
      {{ isEditMode ? 'Guardar Cambios' : 'Agregar Restaurante' }}
    </button>
  </div>
</form>
</div>
</div>